# Инструкция по запуску системы управления автопарком

В данной инструкции описаны способы запуска и устранения возможных проблем в системе, состоящей из веб-интерфейса и Telegram-бота.

## Стандартный способ запуска (рекомендуется)

Для запуска всей системы (веб-интерфейс + Telegram бот) выполните команду:

```bash
python start_services.py
```

Этот скрипт автоматически:
1. Остановит конфликтующие процессы
2. Проверит доступность порта 5000
3. Инициализирует базу данных
4. Запустит веб-интерфейс и Telegram бота
5. Будет мониторить процессы и перезапускать их при необходимости

## Запуск через workflow (альтернативный способ)

Для запуска через workflow в Replit:

1. Запустите workflow "Start application" для веб-интерфейса
2. Запустите workflow "telegram_bot" для Telegram бота

**Важно:** Запуск второго воркфлоу может привести к завершению первого из-за конфликтов. Если это происходит, используйте стандартный способ запуска или следуйте инструкциям по устранению проблем.

## Устранение проблем

### Порт 5000 занят

Если вы видите ошибку "Port 5000 is in use", выполните следующие команды:

```bash
# Остановка всех Python-процессов (будьте осторожны, это остановит все скрипты)
pkill python

# Проверка, что порт освободился
curl -s localhost:5000 || echo "Порт 5000 свободен"
```

### Бот останавливается после запуска

Если Telegram бот запускается, но сразу останавливается:

1. Проверьте файл main.py - он не должен останавливать сам себя
2. Убедитесь, что токен бота валиден:
   ```bash
   curl -s "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/getMe" | grep username
   ```
3. Очистите вебхук:
   ```bash
   curl -s "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/deleteWebhook?drop_pending_updates=true"
   ```

### Мониторинг работающих процессов

Для проверки запущенных процессов используйте команду:

```bash
ps aux | grep python
```

## Раздельный запуск компонентов

Если вам нужно запустить только один из компонентов:

### Только веб-интерфейс:

```bash
python deployment_start.py
```

### Только Telegram-бот:

```bash
python main.py
```

## Важные файлы системы

- `start_services.py` - скрипт для запуска и мониторинга всех сервисов
- `deployment_start.py` - скрипт запуска веб-интерфейса
- `main.py` - основной скрипт Telegram бота
- `app.py` - код Flask-приложения для веб-интерфейса
- `telegram_bot.py` - основной код Telegram бота
- `db_operations.py` - функции для работы с базой данных
- `vehicles.db` - файл базы данных SQLite